# Define the function as a standalone for testing
import numpy as np

# Mock grid (z)
z = np.array([0.0, 0.25, 0.5, 0.75, 1.0])  # 5 grid points

# Mock species profiles for full and reduced mechanisms
full_profiles = {
    'grid': np.array([0.   , 0.005, 0.01 , 0.015, 0.025, 0.035, 0.05 ]), 
     'temperature_profile': np.array([300.        , 299.99999892, 300.00000059, 300.00000327,
       299.99999437, 299.99994004, 299.99994004]), 
     'mole_fractions': np.array([[ 2.20282938e-10,  8.54964485e-10,  3.80052069e-09,
         3.81348337e-09,  3.77837075e-09,  3.64258389e-09,
         3.64258389e-09], 
       [-3.25570348e-20, -8.03900224e-20, -4.27903867e-16,
        -1.35021393e-15,  1.38774427e-15,  7.34145157e-15,
         7.34145157e-15],
       [ 4.43428691e-16,  3.39925447e-15,  1.47187565e-13,
         3.60795587e-13, -3.10484064e-13, -2.16129187e-12,
        -2.16129187e-12],
       [ 1.05000000e-01,  1.05000000e-01,  1.04999998e-01,
         1.04999997e-01,  1.04999998e-01,  1.05000004e-01,
         1.05000004e-01],
       [ 3.15162686e-17,  2.44752568e-16,  2.62602883e-14,
         1.54058112e-13, -5.12143525e-14, -3.44368051e-13,
        -3.44368051e-13],
       [ 6.38458298e-12,  6.80282175e-11,  7.77408790e-10,
         2.20469463e-09,  9.76201616e-10, -5.15226521e-09,
        -5.15226521e-09],
       [-2.24720562e-13, -2.51904570e-12, -2.78420295e-11,
        -1.24551121e-10, -3.04299947e-10, -1.61055174e-09,
        -1.61055174e-09],
       [ 3.17274231e-15,  3.58261322e-14,  4.12571501e-13,
         4.83967609e-12,  1.56002220e-10,  1.13049175e-09,
         1.13049175e-09],
       [-1.28670255e-22, -9.70513772e-30,  7.16458475e-32,
         5.06748418e-33,  3.67079666e-32, -2.67027464e-31,
         2.16098054e-31],
       [ 2.16569493e-26, -2.36681668e-33, -1.98763885e-32,
        -2.60775673e-31,  7.02767693e-31,  4.61152552e-29,
         4.61152552e-29],
       [ 3.22717945e-23, -5.28457873e-25, -4.14816811e-21,
        -2.13495167e-20, -3.68526397e-20, -2.97283472e-19,
        -2.97283472e-19],
       [-1.46363234e-23, -2.69443286e-26, -2.13684879e-22,
        -1.10070838e-21, -1.89739819e-21, -1.52814646e-20,
        -1.52814646e-20],
       [ 3.00213101e-11,  3.19333587e-10,  1.55411939e-09,
         3.18387792e-09,  3.16389495e-09,  4.83543366e-09,
         4.83543366e-09],
       [ 5.00000000e-01,  4.99999999e-01,  4.99999996e-01,
         4.99999994e-01,  4.99999995e-01,  5.00000001e-01,
         5.00000001e-01],
       [ 9.57616646e-12,  1.05000179e-10,  1.30258440e-09,
         1.34127891e-09,  1.28823975e-09,  9.82798569e-10,
         9.82798569e-10],
       [ 2.12245086e-12,  2.95159528e-11,  4.74918007e-10,
         4.34904559e-10,  4.86771804e-10,  8.12046414e-10,
         8.12046414e-10],
       [-9.21550379e-24, -2.23855313e-23, -3.93414502e-20,
        -1.26320656e-19,  1.66963652e-19,  2.80302583e-18,
         2.80302583e-18],
       [ 1.83065687e-12,  2.70330840e-11,  3.63929557e-10,
         1.79198064e-09,  6.71981447e-10, -5.29697046e-09,
        -5.29697046e-09],
       [ 1.80470493e-27,  2.43796198e-26,  3.56030410e-21,
         8.82275293e-21,  7.18281439e-21, -2.03979230e-21,
        -2.03979230e-21],
       [ 3.58028757e-16,  5.30952754e-15,  4.93152612e-13,
         2.98838552e-12, -9.05328112e-13, -5.67765004e-12,
        -5.67765004e-12],
       [-5.88714635e-15, -8.83552449e-14, -1.32882550e-12,
        -6.65414925e-12,  2.42058066e-14,  4.18042200e-11,
         4.18042200e-11],
       [ 1.51825732e-22,  3.36749595e-30, -4.03998684e-33,
        -9.35694615e-33, -8.21796386e-32, -2.02103962e-31,
        -2.02103962e-31],
       [ 5.51300441e-21,  7.44967474e-20,  1.17432760e-18,
         1.39255625e-18,  1.28811600e-18,  2.85873699e-19,
         2.85873699e-19],
       [-5.45606470e-28, -8.52813374e-27, -7.70459434e-24,
        -3.22027286e-23,  1.30587427e-24,  9.97178351e-23,
         9.97178351e-23],
       [-2.11181974e-14, -3.00998591e-13, -4.20147374e-12,
        -4.62788847e-11, -1.81828717e-11,  6.61754590e-12,
         6.61754590e-12],
       [-2.59436684e-19, -3.95420817e-18, -2.02049877e-15,
        -6.72190370e-14,  2.10995281e-14,  2.52090930e-14,
         2.52090930e-14],
       [-8.97039102e-12, -1.38215977e-10, -7.50890685e-10,
        -1.60599581e-09, -1.58520388e-09, -2.50959834e-09,
        -2.50959834e-09],
       [-1.43100738e-28, -1.35619096e-27, -4.11492326e-25,
        -1.77877790e-24,  1.33328403e-24,  1.98668243e-23,
         1.98668243e-23],
       [ 3.12851814e-20,  5.07670270e-19,  7.99564701e-18,
         2.02303500e-17, -2.54038465e-17, -3.89392843e-16,
        -3.89392842e-16],
       [ 8.34855841e-29,  1.35123953e-27,  2.43033529e-26,
         3.71821495e-26,  2.05961156e-28, -2.62842615e-25,
        -2.62842615e-25],
       [ 1.88837087e-22, -3.41222078e-22,  2.04637748e-24,
         1.00634309e-23, -5.53514638e-24, -2.30162753e-22,
        -2.30162753e-22],
       [ 1.81423954e-22,  2.64377020e-23,  2.76868526e-21,
         1.55635343e-20, -2.30257589e-20, -2.35216209e-19,
        -2.35216209e-19],
       [-3.53794835e-15, -2.64014873e-14, -1.72985226e-13,
        -6.10012084e-13, -2.40104854e-12, -6.62259200e-12,
        -6.62259200e-12],
       [ 1.46573343e-14,  1.58202214e-13,  2.03689091e-12,
         2.45656657e-12,  4.19215925e-12,  8.52004095e-12,
         8.52004095e-12],
       [-4.11883754e-31, -6.07412366e-30, -1.62329736e-25,
        -4.88278340e-25,  5.31164553e-25,  2.75051995e-24,
         2.75051995e-24],
       [ 7.43896686e-20,  8.48011888e-19,  9.27520415e-18,
         3.49274299e-17, -6.12973177e-16, -7.00522084e-15,
        -7.00522084e-15],
       [ 1.56047088e-20,  2.04383284e-19,  2.52168866e-18,
         1.24699884e-17,  3.94528431e-16,  4.97255922e-15,
         4.97255922e-15],
       [ 1.15739099e-25,  1.73808792e-24,  3.47253850e-23,
         1.23143861e-22,  6.68411932e-22,  1.57149662e-21,
         1.57149662e-21],
       [ 2.93221678e-19,  3.30139315e-18,  3.80313128e-17,
         1.55152300e-16, -2.47813038e-15, -2.33704904e-14,
        -2.33704904e-14],
       [-7.36879418e-23, -6.60488140e-30, -1.78198382e-27,
        -4.99575392e-27,  1.22726048e-26,  5.04940040e-26,
         5.04940040e-26],
       [ 4.94015592e-17,  7.19129990e-16,  1.24957574e-14,
         1.32450231e-14,  1.10320123e-14,  1.73004951e-15,
         1.73004951e-15],
       [-1.89103275e-18, -2.75327267e-17, -3.56480550e-16,
        -1.10483513e-15,  1.10647767e-15,  1.03975438e-14,
         1.03975438e-14],
       [ 5.63211338e-29, -5.78283607e-34, -8.37811311e-33,
        -1.26801388e-31,  3.64134539e-31,  2.09064779e-29,
         2.09064779e-29],
       [ 1.10001672e-30,  1.58424312e-29,  2.25777782e-28,
         3.45404243e-27,  1.48590794e-25,  3.64909609e-24,
         3.64909609e-24],
       [ 5.82108034e-25,  8.15027399e-24,  1.32545946e-22,
         1.43794643e-22,  1.90439281e-22,  2.41321403e-22,
         2.41321403e-22],
       [ 2.42141013e-18,  3.39020289e-17,  5.39171467e-16,
         5.90309091e-16,  1.22936759e-15,  4.57606560e-15,
         4.57606560e-15],
       [-3.55210628e-21, -5.11882945e-20, -7.47070778e-19,
        -2.34736681e-18, -4.61284942e-19,  1.51789660e-17,
         1.51789660e-17],
       [ 3.95000000e-01,  3.95000000e-01,  3.94999999e-01,
         3.94999998e-01,  3.94999998e-01,  3.94999998e-01,
         3.94999998e-01],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         0.00000000e+00],
       [ 1.07906025e-14,  2.08098778e-13,  3.88976073e-12,
         5.31364675e-11,  2.85617453e-11,  7.38374695e-12,
         7.38374695e-12],
       [-1.09236869e-16, -2.09959994e-15, -3.67286139e-14,
        -1.00047233e-12, -6.76008166e-13, -2.44755344e-12,
        -2.44755344e-12],
       [-3.77344408e-23, -6.36925735e-22, -8.71733226e-20,
        -2.00144104e-19,  1.82871712e-19,  1.04517229e-18,
         1.04517229e-18],
       [ 8.30773758e-19,  1.40665892e-17,  2.43734054e-16,
         1.10843769e-15,  2.54624010e-15,  3.71760985e-14,
         3.71760985e-14]]), 
       'heat_release_rate': np.array([2.92158306e-05, 1.85657944e-03, 4.34754883e-02, 2.23520757e-01,
       1.70799528e-01, 3.56374383e-01, 3.56374383e-01]), 'max_temperature': np.float64(300.0000032706954), 'flame_thickness': np.float64(0.05), 'H2': np.array([2.20282938e-10, 8.54964485e-10, 3.80052069e-09, 3.81348337e-09,
       3.77837075e-09, 3.64258389e-09, 3.64258389e-09]), 'H': np.array([-3.25570348e-20, -8.03900224e-20, -4.27903867e-16, -1.35021393e-15,
        1.38774427e-15,  7.34145157e-15,  7.34145157e-15]), 'O': np.array([ 4.43428691e-16,  3.39925447e-15,  1.47187565e-13,  3.60795587e-13,
       -3.10484064e-13, -2.16129187e-12, -2.16129187e-12]), 'O2': np.array([0.105, 0.105, 0.105, 0.105, 0.105, 0.105, 0.105]), 'OH': np.array([ 3.15162686e-17,  2.44752568e-16,  2.62602883e-14,  1.54058112e-13,
       -5.12143525e-14, -3.44368051e-13, -3.44368051e-13]), 'H2O': np.array([ 6.38458298e-12,  6.80282175e-11,  7.77408790e-10,  2.20469463e-09,
        9.76201616e-10, -5.15226521e-09, -5.15226521e-09]), 'HO2': np.array([-2.24720562e-13, -2.51904570e-12, -2.78420295e-11, -1.24551121e-10,
       -3.04299947e-10, -1.61055174e-09, -1.61055174e-09]), 'H2O2': np.array([3.17274231e-15, 3.58261322e-14, 4.12571501e-13, 4.83967609e-12,
       1.56002220e-10, 1.13049175e-09, 1.13049175e-09]), 'C': np.array([-1.28670255e-22, -9.70513772e-30,  7.16458475e-32,  5.06748418e-33,
        3.67079666e-32, -2.67027464e-31,  2.16098054e-31]), 'CH': np.array([ 2.16569493e-26, -2.36681668e-33, -1.98763885e-32, -2.60775673e-31,
        7.02767693e-31,  4.61152552e-29,  4.61152552e-29]), 'CH2': np.array([ 3.22717945e-23, -5.28457873e-25, -4.14816811e-21, -2.13495167e-20,
       -3.68526397e-20, -2.97283472e-19, -2.97283472e-19]), 'CH2(S)': np.array([-1.46363234e-23, -2.69443286e-26, -2.13684879e-22, -1.10070838e-21,
       -1.89739819e-21, -1.52814646e-20, -1.52814646e-20]), 'CH3': np.array([3.00213101e-11, 3.19333587e-10, 1.55411939e-09, 3.18387792e-09,
       3.16389495e-09, 4.83543366e-09, 4.83543366e-09]), 'CH4': np.array([0.5       , 0.5       , 0.5       , 0.49999999, 0.5       ,
       0.5       , 0.5       ]), 'CO': np.array([9.57616646e-12, 1.05000179e-10, 1.30258440e-09, 1.34127891e-09,
       1.28823975e-09, 9.82798569e-10, 9.82798569e-10]), 'CO2': np.array([2.12245086e-12, 2.95159528e-11, 4.74918007e-10, 4.34904559e-10,
       4.86771804e-10, 8.12046414e-10, 8.12046414e-10]), 'HCO': np.array([-9.21550379e-24, -2.23855313e-23, -3.93414502e-20, -1.26320656e-19,
        1.66963652e-19,  2.80302583e-18,  2.80302583e-18]), 'CH2O': np.array([ 1.83065687e-12,  2.70330840e-11,  3.63929557e-10,  1.79198064e-09,
        6.71981447e-10, -5.29697046e-09, -5.29697046e-09]), 'CH2OH': np.array([ 1.80470493e-27,  2.43796198e-26,  3.56030410e-21,  8.82275293e-21,
        7.18281439e-21, -2.03979230e-21, -2.03979230e-21]), 'CH3O': np.array([ 3.58028757e-16,  5.30952754e-15,  4.93152612e-13,  2.98838552e-12,
       -9.05328112e-13, -5.67765004e-12, -5.67765004e-12]), 'CH3OH': np.array([-5.88714635e-15, -8.83552449e-14, -1.32882550e-12, -6.65414925e-12,
        2.42058066e-14,  4.18042200e-11,  4.18042200e-11]), 'C2H': np.array([ 1.51825732e-22,  3.36749595e-30, -4.03998684e-33, -9.35694615e-33,
       -8.21796386e-32, -2.02103962e-31, -2.02103962e-31]), 'C2H2': np.array([5.51300441e-21, 7.44967474e-20, 1.17432760e-18, 1.39255625e-18,
       1.28811600e-18, 2.85873699e-19, 2.85873699e-19]), 'C2H3': np.array([-5.45606470e-28, -8.52813374e-27, -7.70459434e-24, -3.22027286e-23,
        1.30587427e-24,  9.97178351e-23,  9.97178351e-23]), 'C2H4': np.array([-2.11181974e-14, -3.00998591e-13, -4.20147374e-12, -4.62788847e-11,
       -1.81828717e-11,  6.61754590e-12,  6.61754590e-12]), 'C2H5': np.array([-2.59436684e-19, -3.95420817e-18, -2.02049877e-15, -6.72190370e-14,
        2.10995281e-14,  2.52090930e-14,  2.52090930e-14]), 'C2H6': np.array([-8.97039102e-12, -1.38215977e-10, -7.50890685e-10, -1.60599581e-09,
       -1.58520388e-09, -2.50959834e-09, -2.50959834e-09]), 'HCCO': np.array([-1.43100738e-28, -1.35619096e-27, -4.11492326e-25, -1.77877790e-24,
        1.33328403e-24,  1.98668243e-23,  1.98668243e-23]), 'CH2CO': np.array([ 3.12851814e-20,  5.07670270e-19,  7.99564701e-18,  2.02303500e-17,
       -2.54038465e-17, -3.89392843e-16, -3.89392842e-16]), 'HCCOH': np.array([ 8.34855841e-29,  1.35123953e-27,  2.43033529e-26,  3.71821495e-26,
        2.05961156e-28, -2.62842615e-25, -2.62842615e-25]), 'N': np.array([ 1.88837087e-22, -3.41222078e-22,  2.04637748e-24,  1.00634309e-23,
       -5.53514638e-24, -2.30162753e-22, -2.30162753e-22]), 'NH': np.array([ 1.81423954e-22,  2.64377020e-23,  2.76868526e-21,  1.55635343e-20,
       -2.30257589e-20, -2.35216209e-19, -2.35216209e-19]), 'NH2': np.array([-3.53794835e-15, -2.64014873e-14, -1.72985226e-13, -6.10012084e-13,
       -2.40104854e-12, -6.62259200e-12, -6.62259200e-12]), 'NH3': np.array([1.46573343e-14, 1.58202214e-13, 2.03689091e-12, 2.45656657e-12,
       4.19215925e-12, 8.52004095e-12, 8.52004095e-12]), 'NNH': np.array([-4.11883754e-31, -6.07412366e-30, -1.62329736e-25, -4.88278340e-25,
        5.31164553e-25,  2.75051995e-24,  2.75051995e-24]), 'NO': np.array([ 7.43896686e-20,  8.48011888e-19,  9.27520415e-18,  3.49274299e-17,
       -6.12973177e-16, -7.00522084e-15, -7.00522084e-15]), 'NO2': np.array([1.56047088e-20, 2.04383284e-19, 2.52168866e-18, 1.24699884e-17,
       3.94528431e-16, 4.97255922e-15, 4.97255922e-15]), 'N2O': np.array([1.15739099e-25, 1.73808792e-24, 3.47253850e-23, 1.23143861e-22,
       6.68411932e-22, 1.57149662e-21, 1.57149662e-21]), 'HNO': np.array([ 2.93221678e-19,  3.30139315e-18,  3.80313128e-17,  1.55152300e-16,
       -2.47813038e-15, -2.33704904e-14, -2.33704904e-14]), 'CN': np.array([-7.36879418e-23, -6.60488140e-30, -1.78198382e-27, -4.99575392e-27,
        1.22726048e-26,  5.04940040e-26,  5.04940040e-26]), 'HCN': np.array([4.94015592e-17, 7.19129990e-16, 1.24957574e-14, 1.32450231e-14,
       1.10320123e-14, 1.73004951e-15, 1.73004951e-15]), 'H2CN': np.array([-1.89103275e-18, -2.75327267e-17, -3.56480550e-16, -1.10483513e-15,
        1.10647767e-15,  1.03975438e-14,  1.03975438e-14]), 'HCNN': np.array([ 5.63211338e-29, -5.78283607e-34, -8.37811311e-33, -1.26801388e-31,
        3.64134539e-31,  2.09064779e-29,  2.09064779e-29]), 'HCNO': np.array([1.10001672e-30, 1.58424312e-29, 2.25777782e-28, 3.45404243e-27,
       1.48590794e-25, 3.64909609e-24, 3.64909609e-24]), 'HOCN': np.array([5.82108034e-25, 8.15027399e-24, 1.32545946e-22, 1.43794643e-22,
       1.90439281e-22, 2.41321403e-22, 2.41321403e-22]), 'HNCO': np.array([2.42141013e-18, 3.39020289e-17, 5.39171467e-16, 5.90309091e-16,
       1.22936759e-15, 4.57606560e-15, 4.57606560e-15]), 'NCO': np.array([-3.55210628e-21, -5.11882945e-20, -7.47070778e-19, -2.34736681e-18,
       -4.61284942e-19,  1.51789660e-17,  1.51789660e-17]), 'N2': np.array([0.395, 0.395, 0.395, 0.395, 0.395, 0.395, 0.395]), 'AR': np.array([0., 0., 0., 0., 0., 0., 0.]), 'C3H7': np.array([1.07906025e-14, 2.08098778e-13, 3.88976073e-12, 5.31364675e-11,
       2.85617453e-11, 7.38374695e-12, 7.38374695e-12]), 'C3H8': np.array([-1.09236869e-16, -2.09959994e-15, -3.67286139e-14, -1.00047233e-12,
       -6.76008166e-13, -2.44755344e-12, -2.44755344e-12]), 'CH2CHO': np.array([-3.77344408e-23, -6.36925735e-22, -8.71733226e-20, -2.00144104e-19,
        1.82871712e-19,  1.04517229e-18,  1.04517229e-18]), 'CH3CHO': np.array([8.30773758e-19, 1.40665892e-17, 2.43734054e-16, 1.10843769e-15,
       2.54624010e-15, 3.71760985e-14, 3.71760985e-14])}

reduced_results = {
    'grid': np.array([0.   , 0.005, 0.01 , 0.015, 0.025, 0.035, 0.05 ]), 
    'temperature_profile': np.array([300.        , 300.00000018, 300.00000428, 300.00000433,
       300.00000312, 300.00004344, 300.00004344]), 
    'mole_fractions': {'H2': np.array([2.06796931e-10, 8.00920940e-10, 3.43603697e-09, 5.91603624e-09,
       6.48150684e-09, 6.16428139e-09, 6.16428139e-09]), 'H': np.array([ 1.02863018e-20,  3.04447101e-20,  3.87018482e-18,  2.76394229e-15,
        8.15846968e-15, -3.83710665e-14, -3.83710665e-14]), 'O': np.array([5.85529804e-17, 4.48580038e-16, 1.99327368e-14, 2.24670721e-14,
       1.13829180e-14, 4.97668102e-13, 4.97668102e-13]), 'O2': np.array([0.105     , 0.105     , 0.105     , 0.105     , 0.105     ,
       0.10499999, 0.10499999]), 'OH': np.array([3.85725186e-16, 2.99425568e-15, 2.51535044e-14, 3.66794815e-12,
       1.62098178e-11, 3.17263999e-11, 3.17263999e-11]), 'H2O': np.array([2.39773159e-12, 2.54103860e-11, 3.24101761e-10, 5.92554013e-10,
       7.11778523e-10, 1.18756115e-09, 1.18756115e-09]), 'HO2': np.array([1.12951352e-13, 1.26310811e-12, 1.40242954e-11, 1.42105051e-10,
       5.49464259e-10, 3.05027864e-09, 3.05027864e-09]), 'H2O2': np.array([-9.31782898e-16, -1.04892716e-14, -1.20142807e-13, -1.42773873e-12,
       -5.91319790e-11, -4.69120686e-10, -4.69120686e-10]), 'C': np.array([3.06381476e-24, 2.46476910e-23, 1.94010181e-22, 1.60316654e-21,
       4.84788364e-21, 2.71195055e-20, 2.71195055e-20]), 'CH': np.array([-1.90624923e-23, -2.09507999e-31,  2.70628937e-31, -1.89683744e-30,
       -2.48933266e-29, -1.42585491e-30, -1.42585491e-30]), 'CH2': np.array([-1.33140888e-22,  1.30872474e-24,  8.69599470e-23,  9.67395104e-20,
        5.79620946e-19, -4.11903020e-19, -4.11903020e-19]), 'CH2(S)': np.array([ 2.08496192e-21,  6.76726813e-26,  4.50167148e-24,  4.99270877e-21,
        2.99184138e-20, -2.11733617e-20, -2.11733617e-20]), 'CH3': np.array([ 1.89235161e-12,  2.01167122e-11,  1.54819685e-10,  1.04726262e-09,
        1.67357214e-09, -2.50299218e-10, -2.50299218e-10]), 'CH4': np.array([0.5       , 0.5       , 0.5       , 0.49999999, 0.49999999,
       0.5       , 0.5       ]), 'CO': np.array([8.38766950e-12, 9.25322496e-11, 1.13839302e-09, 1.87437404e-09,
       1.83839031e-09, 1.88331786e-10, 1.88331786e-10]), 'CO2': np.array([1.95550140e-12, 2.74611280e-11, 4.36874527e-10, 8.45414233e-10,
       1.10208883e-09, 2.77505520e-09, 2.77505520e-09]), 'HCO': np.array([ 2.31297579e-23, -7.14449345e-25, -1.92542072e-22,  1.89536119e-19,
        3.70577571e-19, -3.99074056e-18, -3.99074056e-18]), 'CH2O': np.array([4.73057520e-14, 6.97526882e-13, 1.01635589e-11, 1.36489365e-10,
       4.26985830e-10, 2.33978309e-09, 2.33978309e-09]), 'CH2OH': np.array([ 1.38562698e-28,  2.23570841e-27,  7.53503024e-21, -9.44130313e-20,
        1.45705155e-18, -7.04463916e-19, -7.04463916e-19]), 'CH3O': np.array([1.35026435e-18, 2.00156993e-17, 1.95731952e-15, 2.39116617e-13,
       2.21066487e-13, 1.87936427e-12, 1.87936427e-12]), 'CH3OH': np.array([5.34002515e-16, 7.98723190e-15, 1.19023758e-13, 1.75893430e-12,
       1.81305738e-11, 4.95624631e-12, 4.95624631e-12]), 'C2H': np.array([-4.39876321e-22, -2.77064482e-29,  6.85022243e-33, -7.01412783e-31,
       -1.07336950e-29, -3.27514299e-29, -3.27514299e-29]), 'C2H2': np.array([4.96305276e-21, 6.71148866e-20, 1.01183631e-18, 2.35899205e-18,
       2.82163682e-18, 1.77529111e-17, 1.77529111e-17]), 'C2H3': np.array([2.47032043e-28, 3.43915654e-27, 5.11237163e-25, 6.03476874e-23,
       4.06469899e-22, 1.71004881e-21, 1.71004881e-21]), 'C2H4': np.array([6.01847719e-17, 8.48314506e-16, 1.30590843e-14, 5.65403963e-14,
       7.69626710e-14, 8.63648126e-13, 8.63648126e-13]), 'C2H5': np.array([ 4.20354792e-22,  6.68398262e-21,  1.50423810e-18, -8.33984667e-18,
       -6.14802274e-16,  5.25917595e-17,  5.25917595e-17]), 'C2H6': np.array([-4.69765675e-13, -7.23362000e-12, -6.71506721e-11, -5.81327568e-10,
       -1.05103081e-09, -1.05180495e-09, -1.05180495e-09]), 'HCCO': np.array([-1.76236517e-28,  1.29886276e-28,  5.72670915e-27,  2.66693993e-24,
        1.88185925e-24,  4.39947022e-23,  4.39947022e-23]), 'CH2CO': np.array([6.29739302e-20, 1.04971052e-18, 1.75079011e-17, 2.51350133e-16,
       1.23535872e-14, 4.55045793e-13, 4.55045793e-13]), 'HCCOH': np.array([4.60574463e-24, 4.60395151e-24, 4.63402580e-24, 4.96157225e-24,
       6.96219448e-24, 8.04364917e-24, 1.07153248e-23]), 'N': np.array([-4.82164126e-21,  4.67814054e-22, -5.99258877e-22, -7.71093338e-23,
       -4.62253006e-24, -1.95684266e-24, -1.95684266e-24]), 'NH': np.array([ 4.97255125e-21,  1.56411058e-24, -2.87190757e-24,  2.20337038e-21,
        4.47560132e-20,  6.55307209e-19,  6.55307209e-19]), 'NH2': np.array([1.18578171e-15, 8.83025989e-15, 6.46356953e-14, 4.27722828e-13,
       1.73163312e-12, 7.83981733e-12, 7.83981733e-12]), 'NH3': np.array([ 1.16069472e-14,  1.25464695e-13,  1.62553394e-12,  2.52716684e-12,
        1.60209490e-12, -4.62240353e-12, -4.62240353e-12]), 'NNH': np.array([ 2.98518904e-31,  2.05846438e-30,  3.17608737e-28,  8.65626764e-25,
        2.74539082e-24, -1.39617652e-23, -1.39617652e-23]), 'NO': np.array([1.29508285e-20, 1.46423389e-19, 1.55111341e-18, 1.76591685e-17,
       3.65569037e-16, 3.15771301e-15, 3.15771301e-15]), 'NO2': np.array([5.88889511e-22, 7.71377175e-21, 1.01919025e-19, 1.35380834e-18,
       4.64429814e-17, 7.15415949e-16, 7.15415949e-16]), 'N2O': np.array([-3.92423357e-26, -5.74698132e-25, -1.07175483e-23,  2.05452233e-23,
        8.64951444e-22,  2.95653373e-21,  2.95653373e-21]), 'HNO': np.array([-1.37940920e-24, -3.55815644e-24, -4.38320418e-23, -3.09656466e-22,
       -2.04184401e-20, -2.20573121e-19, -2.20573121e-19]), 'CN': np.array([ 4.71117693e-22,  8.89840450e-29,  1.31723825e-29, -1.91660833e-27,
       -1.65810305e-25, -6.78273372e-25, -6.78273372e-25]), 'HCN': np.array([4.13505397e-17, 6.07116979e-16, 1.05276228e-14, 1.66669562e-14,
       1.05662538e-14, 6.54916921e-14, 6.54916921e-14]), 'H2CN': np.array([ 7.67021448e-19,  1.14370864e-17,  1.56638865e-16,  1.94896096e-15,
        9.68014910e-15, -4.51704544e-14, -4.51704544e-14]), 'HCNN': np.array([ 3.01404106e-25, -3.87685296e-32, -4.63305618e-28,  2.20654809e-27,
       -1.99733493e-27,  4.51993417e-27,  4.51993417e-27]), 'HCNO': np.array([ 2.59433052e-32,  3.74302899e-31,  5.41315928e-30,  7.85164480e-29,
        2.51405159e-27, -3.02698918e-26, -3.02698918e-26]), 'HOCN': np.array([4.96988529e-25, 7.00649682e-24, 1.12477253e-22, 2.01370828e-22,
       4.07262657e-22, 9.93403800e-22, 9.93403800e-22]), 'HNCO': np.array([2.02710053e-18, 2.85775406e-17, 4.59074789e-16, 7.85071150e-16,
       7.32665722e-16, 4.67519107e-16, 4.67519107e-16]), 'NCO': np.array([-8.83870249e-22, -1.27990965e-20, -2.32728713e-20,  3.28556282e-19,
        1.04256417e-18,  8.16368937e-18,  8.16368937e-18]), 'N2': np.array([0.395, 0.395, 0.395, 0.395, 0.395, 0.395, 0.395]), 'AR': np.array([0., 0., 0., 0., 0., 0., 0.]), 'C3H7': np.array([ 6.35964017e-19,  1.22688284e-17,  2.29536343e-16,  3.82942584e-15,
        8.87409902e-15, -1.84769532e-14, -1.84769532e-14]), 'C3H8': np.array([7.10788747e-19, 1.37579872e-17, 2.70404102e-16, 4.80978819e-15,
       5.28342996e-14, 5.31881331e-14, 5.31881331e-14]), 'CH2CHO': np.array([ 3.68001036e-27,  6.17851499e-26,  2.91513742e-24,  5.35398435e-21,
        9.15889869e-20, -1.42919626e-17, -1.42919626e-17]), 'CH3CHO': np.array([-9.80145355e-21, -1.80163366e-19, -1.69105423e-18, -1.57137423e-16,
       -4.19619180e-16, -3.55364582e-15, -3.55364582e-15])}, 
    'heat_release_rate': np.array([ 9.36801451e-06,  8.23088669e-06,  5.71424851e-04,  1.08139536e-01,
        3.06254275e-01, -1.12220958e+00, -1.12220958e+00]), 
    'max_temperature': np.float64(300.0000434351498), 
    'flame_thickness': np.float64(0.05), 'H2': np.array([2.06796931e-10, 8.00920940e-10, 3.43603697e-09, 5.91603624e-09,
       6.48150684e-09, 6.16428139e-09, 6.16428139e-09]), 'H': np.array([ 1.02863018e-20,  3.04447101e-20,  3.87018482e-18,  2.76394229e-15,
        8.15846968e-15, -3.83710665e-14, -3.83710665e-14]), 'O': np.array([5.85529804e-17, 4.48580038e-16, 1.99327368e-14, 2.24670721e-14,
       1.13829180e-14, 4.97668102e-13, 4.97668102e-13]), 'O2': np.array([0.105     , 0.105     , 0.105     , 0.105     , 0.105     ,
       0.10499999, 0.10499999]), 'OH': np.array([3.85725186e-16, 2.99425568e-15, 2.51535044e-14, 3.66794815e-12,
       1.62098178e-11, 3.17263999e-11, 3.17263999e-11]), 'H2O': np.array([2.39773159e-12, 2.54103860e-11, 3.24101761e-10, 5.92554013e-10,
       7.11778523e-10, 1.18756115e-09, 1.18756115e-09]), 'HO2': np.array([1.12951352e-13, 1.26310811e-12, 1.40242954e-11, 1.42105051e-10,
       5.49464259e-10, 3.05027864e-09, 3.05027864e-09]), 'H2O2': np.array([-9.31782898e-16, -1.04892716e-14, -1.20142807e-13, -1.42773873e-12,
       -5.91319790e-11, -4.69120686e-10, -4.69120686e-10]), 'C': np.array([3.06381476e-24, 2.46476910e-23, 1.94010181e-22, 1.60316654e-21,
       4.84788364e-21, 2.71195055e-20, 2.71195055e-20]), 'CH': np.array([-1.90624923e-23, -2.09507999e-31,  2.70628937e-31, -1.89683744e-30,
       -2.48933266e-29, -1.42585491e-30, -1.42585491e-30]), 'CH2': np.array([-1.33140888e-22,  1.30872474e-24,  8.69599470e-23,  9.67395104e-20,
        5.79620946e-19, -4.11903020e-19, -4.11903020e-19]), 'CH2(S)': np.array([ 2.08496192e-21,  6.76726813e-26,  4.50167148e-24,  4.99270877e-21,
        2.99184138e-20, -2.11733617e-20, -2.11733617e-20]), 'CH3': np.array([ 1.89235161e-12,  2.01167122e-11,  1.54819685e-10,  1.04726262e-09,
        1.67357214e-09, -2.50299218e-10, -2.50299218e-10]), 'CH4': np.array([0.5       , 0.5       , 0.5       , 0.49999999, 0.49999999,
       0.5       , 0.5       ]), 'CO': np.array([8.38766950e-12, 9.25322496e-11, 1.13839302e-09, 1.87437404e-09,
       1.83839031e-09, 1.88331786e-10, 1.88331786e-10]), 'CO2': np.array([1.95550140e-12, 2.74611280e-11, 4.36874527e-10, 8.45414233e-10,
       1.10208883e-09, 2.77505520e-09, 2.77505520e-09]), 'HCO': np.array([ 2.31297579e-23, -7.14449345e-25, -1.92542072e-22,  1.89536119e-19,
        3.70577571e-19, -3.99074056e-18, -3.99074056e-18]), 'CH2O': np.array([4.73057520e-14, 6.97526882e-13, 1.01635589e-11, 1.36489365e-10,
       4.26985830e-10, 2.33978309e-09, 2.33978309e-09]), 'CH2OH': np.array([ 1.38562698e-28,  2.23570841e-27,  7.53503024e-21, -9.44130313e-20,
        1.45705155e-18, -7.04463916e-19, -7.04463916e-19]), 'CH3O': np.array([1.35026435e-18, 2.00156993e-17, 1.95731952e-15, 2.39116617e-13,
       2.21066487e-13, 1.87936427e-12, 1.87936427e-12]), 'CH3OH': np.array([5.34002515e-16, 7.98723190e-15, 1.19023758e-13, 1.75893430e-12,
       1.81305738e-11, 4.95624631e-12, 4.95624631e-12]), 'C2H': np.array([-4.39876321e-22, -2.77064482e-29,  6.85022243e-33, -7.01412783e-31,
       -1.07336950e-29, -3.27514299e-29, -3.27514299e-29]), 'C2H2': np.array([4.96305276e-21, 6.71148866e-20, 1.01183631e-18, 2.35899205e-18,
       2.82163682e-18, 1.77529111e-17, 1.77529111e-17]), 'C2H3': np.array([2.47032043e-28, 3.43915654e-27, 5.11237163e-25, 6.03476874e-23,
       4.06469899e-22, 1.71004881e-21, 1.71004881e-21]), 'C2H4': np.array([6.01847719e-17, 8.48314506e-16, 1.30590843e-14, 5.65403963e-14,
       7.69626710e-14, 8.63648126e-13, 8.63648126e-13]), 'C2H5': np.array([ 4.20354792e-22,  6.68398262e-21,  1.50423810e-18, -8.33984667e-18,
       -6.14802274e-16,  5.25917595e-17,  5.25917595e-17]), 'C2H6': np.array([-4.69765675e-13, -7.23362000e-12, -6.71506721e-11, -5.81327568e-10,
       -1.05103081e-09, -1.05180495e-09, -1.05180495e-09]), 'HCCO': np.array([-1.76236517e-28,  1.29886276e-28,  5.72670915e-27,  2.66693993e-24,
        1.88185925e-24,  4.39947022e-23,  4.39947022e-23]), 'CH2CO': np.array([6.29739302e-20, 1.04971052e-18, 1.75079011e-17, 2.51350133e-16,
       1.23535872e-14, 4.55045793e-13, 4.55045793e-13]), 'HCCOH': np.array([4.60574463e-24, 4.60395151e-24, 4.63402580e-24, 4.96157225e-24,
       6.96219448e-24, 8.04364917e-24, 1.07153248e-23]), 'N': np.array([-4.82164126e-21,  4.67814054e-22, -5.99258877e-22, -7.71093338e-23,
       -4.62253006e-24, -1.95684266e-24, -1.95684266e-24]), 'NH': np.array([ 4.97255125e-21,  1.56411058e-24, -2.87190757e-24,  2.20337038e-21,
        4.47560132e-20,  6.55307209e-19,  6.55307209e-19]), 'NH2': np.array([1.18578171e-15, 8.83025989e-15, 6.46356953e-14, 4.27722828e-13,
       1.73163312e-12, 7.83981733e-12, 7.83981733e-12]), 'NH3': np.array([ 1.16069472e-14,  1.25464695e-13,  1.62553394e-12,  2.52716684e-12,
        1.60209490e-12, -4.62240353e-12, -4.62240353e-12]), 'NNH': np.array([ 2.98518904e-31,  2.05846438e-30,  3.17608737e-28,  8.65626764e-25,
        2.74539082e-24, -1.39617652e-23, -1.39617652e-23]), 'NO': np.array([1.29508285e-20, 1.46423389e-19, 1.55111341e-18, 1.76591685e-17,
       3.65569037e-16, 3.15771301e-15, 3.15771301e-15]), 'NO2': np.array([5.88889511e-22, 7.71377175e-21, 1.01919025e-19, 1.35380834e-18,
       4.64429814e-17, 7.15415949e-16, 7.15415949e-16]), 'N2O': np.array([-3.92423357e-26, -5.74698132e-25, -1.07175483e-23,  2.05452233e-23,
        8.64951444e-22,  2.95653373e-21,  2.95653373e-21]), 'HNO': np.array([-1.37940920e-24, -3.55815644e-24, -4.38320418e-23, -3.09656466e-22,
       -2.04184401e-20, -2.20573121e-19, -2.20573121e-19]), 'CN': np.array([ 4.71117693e-22,  8.89840450e-29,  1.31723825e-29, -1.91660833e-27,
       -1.65810305e-25, -6.78273372e-25, -6.78273372e-25]), 'HCN': np.array([4.13505397e-17, 6.07116979e-16, 1.05276228e-14, 1.66669562e-14,
       1.05662538e-14, 6.54916921e-14, 6.54916921e-14]), 'H2CN': np.array([ 7.67021448e-19,  1.14370864e-17,  1.56638865e-16,  1.94896096e-15,
        9.68014910e-15, -4.51704544e-14, -4.51704544e-14]), 'HCNN': np.array([ 3.01404106e-25, -3.87685296e-32, -4.63305618e-28,  2.20654809e-27,
       -1.99733493e-27,  4.51993417e-27,  4.51993417e-27]), 'HCNO': np.array([ 2.59433052e-32,  3.74302899e-31,  5.41315928e-30,  7.85164480e-29,
        2.51405159e-27, -3.02698918e-26, -3.02698918e-26]), 'HOCN': np.array([4.96988529e-25, 7.00649682e-24, 1.12477253e-22, 2.01370828e-22,
       4.07262657e-22, 9.93403800e-22, 9.93403800e-22]), 'HNCO': np.array([2.02710053e-18, 2.85775406e-17, 4.59074789e-16, 7.85071150e-16,
       7.32665722e-16, 4.67519107e-16, 4.67519107e-16]), 'NCO': np.array([-8.83870249e-22, -1.27990965e-20, -2.32728713e-20,  3.28556282e-19,
        1.04256417e-18,  8.16368937e-18,  8.16368937e-18]), 'N2': np.array([0.395, 0.395, 0.395, 0.395, 0.395, 0.395, 0.395]), 'AR': np.array([0., 0., 0., 0., 0., 0., 0.]), 'C3H7': np.array([ 6.35964017e-19,  1.22688284e-17,  2.29536343e-16,  3.82942584e-15,
        8.87409902e-15, -1.84769532e-14, -1.84769532e-14]), 'C3H8': np.array([7.10788747e-19, 1.37579872e-17, 2.70404102e-16, 4.80978819e-15,
       5.28342996e-14, 5.31881331e-14, 5.31881331e-14]), 'CH2CHO': np.array([ 3.68001036e-27,  6.17851499e-26,  2.91513742e-24,  5.35398435e-21,
        9.15889869e-20, -1.42919626e-17, -1.42919626e-17]), 'CH3CHO': np.array([-9.80145355e-21, -1.80163366e-19, -1.69105423e-18, -1.57137423e-16,
       -4.19619180e-16, -3.55364582e-15, -3.55364582e-15]), 
        'species_names': ['H2', 'H', 'O', 'O2', 'OH', 'H2O', 'HO2', 'H2O2', 'C', 
                          'CH', 'CH2', 'CH2(S)', 'CH3', 'CH4', 'CO', 'CO2', 'HCO', 
                          'CH2O', 'CH2OH', 'CH3O', 'CH3OH', 'C2H', 'C2H2', 'C2H3', 
                          'C2H4', 'C2H5', 'C2H6', 'HCCO', 'CH2CO', 'HCCOH', 'N', 
                          'NH', 'NH2', 'NH3', 'NNH', 'NO', 'NO2', 'N2O', 'HNO', 
                          'CN', 'HCN', 'H2CN', 'HCNN', 'HCNO', 'HOCN', 'HNCO', 
                          'NCO', 'N2', 'AR', 'C3H7', 'C3H8', 'CH2CHO', 'CH3CHO']
}



# Species in the reduced mechanism
species_reduced = ['H2', 'H', 'O', 'O2', 'OH', 'H2O', 'HO2', 'H2O2', 'C', 'CH', 
                   'CH2', 'CH2(S)', 'CH3', 'CH4', 'CO', 'CO2', 'HCO', 'CH2O', 
                   'CH2OH', 'CH3O', 'CH3OH', 'C2H', 'C2H2', 'C2H3', 'C2H4', 'C2H5', 
                   'C2H6', 'HCCO', 'CH2CO', 'HCCOH', 'N', 'NH', 'NH2', 'NH3', 'NNH', 
                   'NO', 'NO2', 'N2O', 'HNO', 'CN', 'HCN', 'H2CN', 'HCNN', 'HCNO', 
                   'HOCN', 'HNCO', 'NCO', 'N2', 'AR', 'C3H7', 'C3H8', 'CH2CHO', 
                   'CH3CHO']

# Small epsilon to avoid division by zero
epsilon = 0



def calculate_premix_fitness(species_reduced, full_profiles, reduced_results, epsilon):
    total_error = 0.0
    z = full_profiles['grid']
    condition_error = 0.0

    for k, species in enumerate(species_reduced):
        if species not in full_profiles or species not in reduced_results["mole_fractions"]:
            continue
        Y_orig = full_profiles[species]
        Y_calcd = reduced_results["mole_fractions"][species]
        
        # print(f"Species: {species}")
        # print(f"Y_orig: {Y_orig}")
        # print(f"Y_calcd: {Y_calcd}")
        
        # W_k = 1.0 if np.max(Y_orig) >= 1e-7 else 0.0
        # if W_k == 0.0:
        #     continue
        W_k = 1.0
        l2_orig = np.sqrt(np.trapezoid(Y_orig**2, z))

        diff = Y_calcd - Y_orig
        l2_diff = np.sqrt(np.trapezoid(diff**2, z))

        if l2_orig > 0:
            relative_error = W_k * l2_diff / l2_orig
        else:
            relative_error = 0 if l2_diff == 0 else W_k  # handle edge cases
            
        # print(f"L2_orig: {l2_orig}, L2_diff: {l2_diff}")
        # print(f"Relative error for {species}: {relative_error}")
        
        condition_error += relative_error
        # print(f"Condition error: {condition_error}\n")

    total_error += condition_error
    # print(f"Total error: {total_error}\n")
    
    return 1.0 / (epsilon + total_error)

# Call the function with mock data
fitness = calculate_premix_fitness(species_reduced, full_profiles, reduced_results, epsilon)
print(f"Calculated fitness: {fitness}")